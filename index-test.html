<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V72-Fix (ç©©å®šéŸ¿éˆ´ç‰ˆ)</title>
    <style>
        :root { --primary: #00695c; --bg: #f0f2f5; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--text); -webkit-font-smoothing: antialiased; }
        
        /* LINE é®ç½© */
        #line-warning { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 99999; color: white; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; box-sizing: border-box; }
        .arrow-icon { font-size: 40px; animation: bounce 1.5s infinite; margin-bottom: 20px; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .container { padding: 16px; display: none; animation: fadeIn 0.4s ease-out; max-width: 600px; margin: 0 auto; }
        .active-tab { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: var(--primary); font-size: 19px; border-left: 5px solid var(--primary); padding-left: 10px; margin-bottom: 15px; font-weight: 700; letter-spacing: 0.5px; }
        
        label { display: block; margin: 12px 0 6px; font-weight: 600; font-size: 15px; color: #444; }
        .required::after { content: " *"; color: #e53935; }
        
        /* è¼¸å…¥æ¡†çµ±ä¸€ */
        input, select, textarea { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; background: #fafafa; transition: border 0.2s, background 0.2s; appearance: none; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; outline: none; }
        
        button, .btn { width: 100%; padding: 14px; font-size: 16px; font-weight: 600; margin-top: 12px; cursor: pointer; color: white; border: none; border-radius: 10px; text-align: center; letter-spacing: 1px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.98); }
        .btn-blue { background: #039be5; } .btn-green { background: #43a047; } .btn-red { background: #e53935; } 
        .btn-orange { background: #fb8c00; } .btn-upload { background: #5e35b1; }
        .btn-outline { background: white; color: var(--primary); border: 1px solid var(--primary); box-shadow: none; }

        .img-preview-box { display: flex; gap: 12px; margin-top: 8px; overflow-x: auto; padding-bottom: 5px; }
        .preview-item { width: 90px; height: 90px; background: #f5f5f5; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative; border: 2px dashed #ccc; flex-shrink: 0; cursor: pointer; }
        .preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .preview-label { font-size: 11px; margin-top: 4px; color: #666; font-weight: bold; }
        .preview-icon { font-size: 28px; color: #999; }

        /* è¨ˆæ™‚å™¨æ¨£å¼ */
        .timer-container { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .timer-box { width: 110px; height: 110px; border-radius: 50%; background: white; border: 6px solid #eceff1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; position: relative; box-shadow: 0 6px 10px rgba(0,0,0,0.05); transition: all 0.3s; }
        .timer-box.running { border-color: #ffb74d; animation: pulse 1.5s infinite; }
        .timer-box.done { border-color: #ef5350; background: #ffebee; animation: shake 0.5s; }
        .timer-time { font-size: 26px; font-weight: 800; color: #455a64; font-variant-numeric: tabular-nums; }
        .timer-label { font-size: 12px; color: #90a4ae; font-weight: bold; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); box-shadow: 0 -2px 10px rgba(0,0,0,0.03); }
        .nav-item { flex: 1; text-align: center; font-size: 11px; color: #b0bec5; padding-top: 5px; cursor: pointer; transition: color 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item span { display: block; font-size: 24px; margin-bottom: 2px; }

        .footer-credit { text-align: center; font-size: 13px; color: #90a4ae; margin-top: 30px; padding-bottom: 20px; line-height: 1.6; border-top: 1px dashed #cfd8dc; padding-top: 15px; }
        .footer-credit a { color: var(--primary); text-decoration: none; font-weight: bold; }

        .camera-box { position: relative; display: none; background: #000; border-radius: 16px; overflow: hidden; margin-top: 15px; }
        .scanner-view { width: 100%; min-height: 300px; }
        .btn-snap-div { width: 72px; height: 72px; background: rgba(255,255,255,0.95); border-radius: 50%; border: 4px solid var(--primary); display: flex; justify-content: center; align-items: center; cursor: pointer; margin: 0 auto; position: absolute; bottom: 25px; left: 0; right: 0; z-index: 10; font-size: 32px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        .ai-result-box { display: none; border: 2px solid var(--primary); background: #e0f2f1; padding: 20px; border-radius: 16px; margin-top: 15px; text-align: center; }
        #loading-mask { display:none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); flex-direction:column; justify-content:center; align-items:center; z-index:9999; backdrop-filter: blur(5px); }
        .spinner { width: 50px; height: 50px; border: 5px solid #eceff1; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* åœ“é¤…åœ–ä¿®æ­£ï¼šé è¨­èƒŒæ™¯é€æ˜ */
        .pie-chart { width: 130px; height: 130px; border-radius: 50%; margin: 10px auto; transition: all 0.3s; border: 2px dashed #ddd; background: transparent; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
        th, td { border-bottom: 1px solid #eee; padding: 10px 5px; }
    </style>
</head>
<body>

    <div id="line-warning">
        <div class="arrow-icon">â†—ï¸</div>
        <h1>è«‹é»æ“Šå³ä¸Šè§’<br>ä½¿ç”¨å…¶ä»–ç€è¦½å™¨é–‹å•Ÿ</h1>
        <p>LINE å…§å»ºç€è¦½å™¨ä¸æ”¯æ´ç›¸æ©Ÿèˆ‡å®šä½åŠŸèƒ½ã€‚<br>è«‹åˆ‡æ›è‡³ Chrome (Android) æˆ– Safari (iOS)ã€‚</p>
    </div>

    <div id="loading-mask"><div class="spinner"></div><p id="loading-text" style="margin-top:15px; color:#555; font-weight:bold;">ç³»çµ±è¼‰å…¥ä¸­...</p></div>

    <div id="view-basic" class="container active-tab">
        <h2>ğŸ“ 1. åƒèˆ‡äººå“¡è³‡è¨Š</h2>
        <div class="card">
            <label class="required">å¡«è¡¨äººå§“å</label>
            <input type="text" id="inp_name" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å">
            <label class="required">è¯çµ¡äººæ‰‹æ©Ÿ</label>
            <input type="tel" id="inp_phone" placeholder="09xx-xxx-xxx">
            <label class="required">åƒèˆ‡äººæ•¸</label>
            <input type="number" id="inp_participants" value="1" min="1" style="text-align:center;">
        </div>

        <h2>ğŸ“ 2. èª¿æŸ¥åœ°é»</h2>
        <div class="card">
            <label>GPS / ç¸£å¸‚é„‰é®</label>
            <div style="display:flex; gap:10px;">
                <input type="text" id="inp_gps" readonly placeholder="å°šæœªå®šä½" style="flex:1; font-size:13px; color:#666; background:#f5f5f5;">
                <button onclick="runGPS()" class="btn-blue" style="flex:0.6; margin-top:0;">ğŸ“¡ å®šä½</button>
            </div>
            <input type="text" id="inp_city" readonly placeholder="å®šä½å¾Œè‡ªå‹•é¡¯ç¤ºç¸£å¸‚é„‰é®" style="margin-top:10px; background:#e0f2f1; color:#00695c; font-weight:bold; border-color:#b2dfdb;">
            <label>èª¿æŸ¥æ¨£é» (è‹±æ–‡ä»£è™Ÿ)</label>
            <input type="text" id="inp_point" placeholder="ä¾‹å¦‚: A, B (è‡ªå‹•è½‰å¤§å¯«)" style="text-transform:uppercase; letter-spacing:1px;" oninput="this.value = this.value.toUpperCase()">
            
            <label>ğŸ“¸ ç¾å ´ç…§ç‰‡ä¸Šå‚³</label>
            <div class="img-preview-box">
                <input type="file" id="file-env" accept="image/*" style="display:none" onchange="handleImgUpload(this, 'env')">
                <input type="file" id="file-group" accept="image/*" style="display:none" onchange="handleImgUpload(this, 'group')">
                <div class="preview-item" onclick="document.getElementById('file-env').click()">
                    <img id="img-preview-env" src="" style="display:none">
                    <span id="icon-env" class="preview-icon">ğŸï¸</span><div class="preview-label">ç’°å¢ƒç…§</div>
                </div>
                <div class="preview-item" onclick="document.getElementById('file-group').click()">
                    <img id="img-preview-group" src="" style="display:none">
                    <span id="icon-group" class="preview-icon">ğŸ‘¥</span><div class="preview-label">åˆç…§</div>
                </div>
            </div>
        </div>

        <h2>â±ï¸ èª¿æŸ¥è¨ˆæ™‚å™¨</h2>
        <div class="card">
            <p style="text-align:center; font-size:13px; color:#78909c; margin:0 0 10px;">é»æ“Šåœ“åœˆé–‹å§‹ / æš«åœ (çµæŸæœƒéœ‡å‹•èˆ‡éŸ¿éˆ´)</p>
            <div class="timer-container">
                <div class="timer-box" id="timer-10" onclick="toggleTimer(10)">
                    <div class="timer-time"

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V22</title>

    <style>
        /* åŸºç¤è¨­å®š */
        body { font-family: -apple-system, system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 10px; padding-bottom: 80px; color: #333; }
        
        /* è¨ºæ–·æ¡† */
        #debug-bar {
            background: #28a745; color: white; font-size: 12px; padding: 5px; 
            margin-bottom: 10px; border-radius: 5px; text-align: center;
        }

        .card { 
            background: white; padding: 15px; border-radius: 12px; 
            margin-bottom: 15px; border: 1px solid #ddd; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2 { margin-top: 0; color: #0056b3; font-size: 18px; border-bottom: 2px solid #e3f2fd; padding-bottom: 8px; }
        
        input, select { 
            width: 100%; padding: 12px; font-size: 16px; margin: 5px 0 15px 0; 
            border: 2px solid #cfd8dc; border-radius: 8px; background: #fff; box-sizing: border-box;
        }

        button { 
            width: 100%; padding: 14px; font-size: 16px; font-weight: bold; 
            margin-top: 5px; cursor: pointer; color: white; border: none; border-radius: 8px; 
        }
        .btn-blue { background: #0288d1; }
        .btn-green { background: #2e7d32; }
        .btn-red { background: #d32f2f; }
        .btn-orange { background: #f57c00; }

        /* === é—œéµæŠ€è¡“ï¼šCSS ç´”ä»£ç¢¼åœ“é¤…åœ– === */
        .pie-chart {
            width: 200px; height: 200px; border-radius: 50%;
            background: conic-gradient(#eee 0% 100%);
            margin: 20px auto;
            border: 1px solid #ccc;
        }
        
        /* åœ–ä¾‹ */
        .legend-item { font-size: 13px; display: inline-block; margin: 3px 8px; }
        .color-box { display: inline-block; width: 10px; height: 10px; margin-right: 5px; }

        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    </style>

    <script>
        // === 1. åˆå§‹åŒ– (çµ•å°å®‰å…¨) ===
        window.onload = function() {
            document.getElementById('debug-bar').innerText = "âœ… V22 æ ¸å¿ƒå·²å•Ÿå‹• (ç„¡å¤–éƒ¨ä¾è³´)";
            
            // å¡«å…¥æ—¥æœŸ
            var d = new Date();
            document.getElementById('out_date').innerText = d.getFullYear() + "/" + (d.getMonth()+1) + "/" + d.getDate();
        };

        // === è®Šæ•¸ ===
        var count = 0;
        var stats = {};
        var historyStack = [];
        
        // å®šç¾©é¡è‰² (çµ¦ CSS åœ“é¤…åœ–ç”¨)
        var colors = {
            'ğŸ‡¹ğŸ‡¼ å°ç£': '#e53935', // ç´…
            'ğŸ‡¨ğŸ‡³ ä¸­åœ‹': '#1e88e5', // è—
            'ğŸ‡¯ğŸ‡µ æ—¥æœ¬': '#43a047', // ç¶ 
            'ğŸ‡°ğŸ‡· éŸ“åœ‹': '#fdd835', // é»ƒ
            'ğŸ‡»ğŸ‡³ è¶Šå—': '#8e24aa', // ç´«
            'ğŸ‡¹ğŸ‡­ æ³°åœ‹': '#fb8c00', // æ©˜
            'ğŸ‡®ğŸ‡© å°å°¼': '#00acc1', // é’
            'ğŸ‡µğŸ‡­ è²å¾‹è³“': '#6d4c41', // æ£•
            'ğŸ‡ºğŸ‡¸ ç¾åœ‹': '#546e7a', // ç°
            'â“ ç„¡æ³•è¾¨è­˜': '#757575' // æ·±ç°
        };

        // === 2. GPS ===
        window.runGPS = function() {
            var field = document.getElementById('inp_gps');
            field.value = "å®šä½ä¸­...";

            if(!navigator.geolocation) {
                alert("æ‰‹æ©Ÿä¸æ”¯æ´ GPS");
                field.value = "ä¸æ”¯æ´";
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(pos) {
                    var txt = pos.coords.latitude.toFixed(5) + ", " + pos.coords.longitude.toFixed(5);
                    field.value = txt;
                    document.getElementById('out_gps').innerText = txt;
                    alert("å®šä½æˆåŠŸï¼");
                },
                function(err) {
                    field.value = "å®šä½å¤±æ•—";
                    alert("å®šä½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥");
                },
                { timeout: 10000 }
            );
        };

        // === 3. åŒæ­¥è³‡æ–™ ===
        window.syncData = function() {
            document.getElementById('out_name').innerText = document.getElementById('inp_name').value;
            document.getElementById('out_loc').innerText = document.getElementById('inp_loc').value;
        };

        // === 4. å¢åŠ è¨˜éŒ„ ===
        window.addRecord = function() {
            var sel = document.getElementById('sel_country');
            var val = sel.value;

            if(!val) { alert("è«‹é¸æ“‡åœ‹å®¶"); return; }

            // é‚è¼¯
            if(!stats[val]) stats[val] = 0;
            stats[val]++;
            count++;
            historyStack.push(val);

            // æ›´æ–°ç•«é¢
            document.getElementById('disp_count').innerText = count;
            sel.value = ""; // é‡ç½®

            // æ›´æ–°è¡¨æ ¼ & CSS åœ–è¡¨
            renderTable();
            drawCssChart();
            
            // æç¤º
            if(count == 10) alert("ğŸ‰ å·²æ»¿ 10 å€‹ï¼è«‹æˆªåœ–ä¿å­˜å ±å‘Šã€‚");
        };

        // === 5. åˆªé™¤è¨˜éŒ„ ===
        window.undoRecord = function() {
            if(count <= 0) return;
            var last = historyStack.pop();
            stats[last]--;
            if(stats[last] === 0) delete stats[last];
            count--;

            document.getElementById('disp_count').innerText = count;
            renderTable();
            drawCssChart();
        };

        // === 6. æ¸²æŸ“è¡¨æ ¼ ===
        function renderTable() {
            var tbody = document.getElementById('stats-body');
            tbody.innerHTML = "";

            if(count === 0) {
                tbody.innerHTML = "<tr><td colspan='2'>ç„¡è³‡æ–™</td></tr>";
                return;
            }

            for(var key in stats) {
                var tr = document.createElement('tr');
                tr.innerHTML = "<td><span class='color-box' style='background:"+(colors[key]||'#ccc')+"'></span>" + key + "</td><td>" + stats[key] + "</td>";
                tbody.appendChild(tr);
            }
        }

        // === 7. ç¹ªè£½ CSS åœ“é¤…åœ– (æ ¸å¿ƒé»‘ç§‘æŠ€) ===
        function drawCssChart() {
            if(count === 0) {
                document.getElementById('css-pie').style.background = "conic-gradient(#eee 0% 100%)";
                return;
            }

            var gradientStr = [];
            var currentDeg = 0;

            for(var key in stats) {
                var qty = stats[key];
                var percent = qty / count;
                var deg = percent * 360; // ä½”å¤šå°‘è§’åº¦
                
                var color = colors[key] || '#999';
                
                // æ‹¼æ¥ CSS èªæ³•: color startDeg endDeg
                var endDeg = currentDeg + deg;
                gradientStr.push(color + " " + currentDeg.toFixed(1) + "deg " + endDeg.toFixed(1) + "deg");
                
                currentDeg = endDeg;
            }

            var finalCss = "conic-gradient(" + gradientStr.join(", ") + ")";
            document.getElementById('css-pie').style.background = finalCss;
        }

        // === 8. ç…§ç‰‡é è¦½ ===
        window.previewImage = function(event) {
            var file = event.target.files[0];
            if(file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = document.getElementById('out_img');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        };
    </script>
</head>
<body>

    <div id="debug-bar">è¼‰å…¥ä¸­...</div>

    <h1>ğŸ“‹ æµ·å»¢èª¿æŸ¥ V22 (åŸç”Ÿç‰ˆ)</h1>

    <div class="card">
        <h2>1. è¨­å®š</h2>
        <label>å§“åï¼š</label>
        <input type="text" id="inp_name" placeholder="è¼¸å…¥å§“å" oninput="syncData()">
        
        <label>GPSï¼š</label>
        <button onclick="runGPS()" class="btn-blue">ğŸ“ æŠ“å– GPS</button>
        <input type="text" id="inp_gps" readonly value="å°šæœªå®šä½" style="background:#eee;">
        
        <label>åœ°é»ï¼š</label>
        <input type="text" id="inp_loc" placeholder="è¼¸å…¥åœ°é»" oninput="syncData()">
    </div>

    <div class="card">
        <h2>2. è¨˜éŒ„</h2>
        <div style="text-align:center; font-size:20px; font-weight:bold; margin-bottom:10px;">
            æ•¸é‡ï¼š<span id="disp_count" style="color:red;">0</span> / 10
        </div>
        
        <label>å·¥å…·ï¼š</label>
        <input type="file" accept="image/*" capture="environment" id="cam-input" style="display:none;">
        <button class="btn-orange" onclick="document.getElementById('cam-input').click()">ğŸ“· é–‹å•Ÿç›¸æ©Ÿæƒææ¢ç¢¼</button>
        <div style="font-size:12px; color:#666; margin-top:5px; text-align:center;">
            (è«‹ä½¿ç”¨ç›¸æ©ŸæŸ¥çœ‹æ¢ç¢¼ï¼Œç„¶å¾Œåœ¨ä¸‹æ–¹æ‰‹å‹•é¸æ“‡)
        </div>

        <label style="margin-top:15px;">é¸æ“‡ä¾†æºåœ‹ï¼š</label>
        <select id="sel_country">
            <option value="">ğŸ‘‡ é»æ­¤é¸æ“‡...</option>
            <option value="ğŸ‡¹ğŸ‡¼ å°ç£">ğŸ‡¹ğŸ‡¼ å°ç£</option>
            <option value="ğŸ‡¨ğŸ‡³ ä¸­åœ‹">ğŸ‡¨ğŸ‡³ ä¸­åœ‹</option>
            <option value="ğŸ‡¯ğŸ‡µ æ—¥æœ¬">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
            <option value="ğŸ‡°ğŸ‡· éŸ“åœ‹">ğŸ‡°ğŸ‡· éŸ“åœ‹</option>
            <option value="ğŸ‡»ğŸ‡³ è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå—</option>
            <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
            <option value="ğŸ‡®ğŸ‡© å°å°¼">ğŸ‡®ğŸ‡© å°å°¼</option>
            <option value="ğŸ‡µğŸ‡­ è²å¾‹è³“">ğŸ‡µğŸ‡­ è²å¾‹è³“</option>
            <option value="ğŸ‡ºğŸ‡¸ ç¾åœ‹">ğŸ‡ºğŸ‡¸ ç¾åœ‹</option>
            <option value="â“ ç„¡æ³•è¾¨è­˜">â“ ç„¡æ³•è¾¨è­˜</option>
        </select>

        <button onclick="addRecord()" class="btn-green">â• å¢åŠ ä¸€ç­†</button>
        <button onclick="undoRecord()" class="btn-red">â†©ï¸ åˆªé™¤ä¸Šä¸€ç­†</button>
    </div>

    <div class="card">
        <h2>3. å ±å‘Šé è¦½ (è«‹æˆªåœ–)</h2>
        
        <div style="border:3px solid #0056b3; background:white;">
            <div style="background:#0056b3; color:white; padding:8px; text-align:center; font-weight:bold;">
                æµ·å»¢èª¿æŸ¥å ±å‘Š
            </div>
            <div style="padding:15px;">
                <div style="font-size:14px; line-height:1.6; border-bottom:1px solid #ccc; padding-bottom:10px;">
                    <strong>æ—¥æœŸï¼š</strong><span id="out_date"></span><br>
                    <strong>å§“åï¼š</strong><span id="out_name"></span><br>
                    <strong>GPSï¼š</strong><span id="out_gps"></span><br>
                    <strong>åœ°é»ï¼š</strong><span id="out_loc"></span>
                </div>
                
                <div id="css-pie" class="pie-chart"></div>

                <table id="stats-table">
                    <thead><tr><th>åœ‹å®¶</th><th>æ•¸é‡</th></tr></thead>
                    <tbody id="stats-body"><tr><td colspan="2">ç„¡è³‡æ–™</td></tr></tbody>
                </table>

                <img id="out_img" class="evidence-img">
            </div>
        </div>

        <label style="margin-top:15px;">ğŸ“¸ ä¸Šå‚³ç…§ç‰‡ï¼š</label>
        <input type="file" accept="image/*" onchange="previewImage(event)">
    </div>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V8 (å®‰å…¨æ¨¡å¼)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        body {
            font-family: sans-serif;
            background-color: #e0f2f1;
            text-align: center;
            padding: 10px;
            margin: 0;
            color: #333;
        }

        /* é é¢å€å¡Šï¼šé è¨­å…¨éƒ¨éš±è—ï¼Œé€é JS æ‰“é–‹ */
        #page1_setup, #page2_survey, #page3_report {
            display: none;
        }

        /* è®“ç¬¬ä¸€å€‹é é¢é è¨­é¡¯ç¤º */
        #page1_setup { display: block; }

        .card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            text-align: left;
        }

        h2 { margin-top: 0; color: #00695c; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        input, select {
            width: 100%; padding: 10px; margin: 5px 0 10px 0;
            border: 2px solid #b2dfdb; border-radius: 5px; box-sizing: border-box;
            font-size: 16px; background: #fff;
        }

        button {
            width: 100%; padding: 12px; border: none; border-radius: 5px;
            font-size: 18px; font-weight: bold; cursor: pointer; color: white;
            margin-top: 10px;
        }
        .btn-green { background-color: #2e7d32; }
        .btn-blue { background-color: #0277bd; }
        .btn-red { background-color: #c62828; }
        .btn-orange { background-color: #ef6c00; }
        
        /* é€²åº¦é¡¯ç¤º */
        #progressInfo {
            background: #fff; padding: 10px; margin-bottom: 10px; border-radius: 5px; font-weight: bold;
        }

        /* æƒææ¡† */
        #reader { width: 100%; background: black; display: none; margin-bottom: 10px; }

        /* å ±å‘Šæˆªåœ–å€ */
        #reportArea {
            background: white; padding: 15px; border: 2px solid #00695c;
            text-align: center; margin-top: 10px;
        }
        .evidence-photo { width: 100%; margin-top: 10px; display: none; border: 1px solid #999; }
    </style>
</head>
<body>

    <div id="page1_setup">
        <h1>ğŸ“‹ æµ·å»¢èª¿æŸ¥è¨­å®š (V8)</h1>
        
        <div class="card">
            <h2>1. åŸºæœ¬è³‡æ–™</h2>
            <label>èª¿æŸ¥å“¡å§“åï¼š</label>
            <input type="text" id="setup_name" placeholder="è«‹è¼¸å…¥å§“å">
            <label>åŒä¼´äººæ•¸ï¼š</label>
            <input type="number" id="setup_team" value="1">
        </div>

        <div class="card">
            <h2>2. åœ°é»å®šä½</h2>
            <button class="btn-blue" onclick="tryGetGPS()">ğŸ“ é»æ­¤æŠ“å– GPS</button>
            <input type="text" id="setup_gps" placeholder="å°šæœªå®šä½" style="background:#eee;" readonly>
            <label>åœ°é»åç¨±ï¼š</label>
            <input type="text" id="setup_loc" placeholder="ä¾‹å¦‚ï¼šå¤–æ¾³æ²™ç˜">
        </div>

        <button class="btn-green" onclick="goToSurvey()">ä¸‹ä¸€æ­¥ï¼šé–‹å§‹èª¿æŸ¥ â¡ï¸</button>
    </div>

    <div id="page2_survey">
        <div id="progressInfo">
            é€²åº¦ï¼š<span id="survey_count" style="color:red; font-size:20px;">0</span> / 10
            <br>
            <button class="btn-orange" onclick="forceFinish()" style="font-size:14px; padding:5px; margin-top:5px; display:none;" id="forceBtn">ğŸ å¼·åˆ¶çµæŸä¸¦æŸ¥çœ‹çµæœ</button>
        </div>

        <div class="card">
            <h2>ğŸ“· æƒææ¢ç¢¼</h2>
            <div id="reader"></div>
            <button id="btn_cam_start" class="btn-blue" onclick="startCam()">å•Ÿå‹•ç›¸æ©Ÿ</button>
            <button id="btn_cam_stop" class="btn-red" onclick="stopCam()" style="display:none;">é—œé–‰ç›¸æ©Ÿ</button>
        </div>

        <div class="card">
            <h2>âŒ¨ï¸ æ‰‹å‹•è¼¸å…¥</h2>
            <input type="number" id="manual_code" placeholder="è¼¸å…¥å‰3ç¢¼ (å¦‚ 471)">
            <select id="manual_select">
                <option value="">ğŸ‘‡ æˆ–ç›´æ¥é¸æ“‡åœ‹å®¶...</option>
                <option value="ğŸ‡¹ğŸ‡¼ å°ç£">ğŸ‡¹ğŸ‡¼ å°ç£ [471]</option>
                <option value="ğŸ‡¨ğŸ‡³ ä¸­åœ‹">ğŸ‡¨ğŸ‡³ ä¸­åœ‹ [690-699]</option>
                <option value="ğŸ‡¯ğŸ‡µ æ—¥æœ¬">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ [450-499]</option>
                <option value="ğŸ‡°ğŸ‡· éŸ“åœ‹">ğŸ‡°ğŸ‡· éŸ“åœ‹ [880]</option>
                <option value="ğŸ‡»ğŸ‡³ è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå— [893]</option>
                <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹">ğŸ‡¹ğŸ‡­ æ³°åœ‹ [885]</option>
                <option value="ğŸ‡®ğŸ‡© å°å°¼">ğŸ‡®ğŸ‡© å°å°¼ [899]</option>
                <option value="ğŸ‡µğŸ‡­ è²å¾‹è³“">ğŸ‡µğŸ‡­ è²å¾‹è³“ [480]</option>
                <option value="ğŸ‡ºğŸ‡¸ ç¾åœ‹">ğŸ‡ºğŸ‡¸ ç¾åœ‹ [000-139]</option>
                <option value="â“ ç„¡æ³•è¾¨è­˜">â“ ç„¡æ³•è¾¨è­˜/å…¶ä»–</option>
            </select>
            <button class="btn-green" onclick="addRecord()">è¨˜éŒ„ä¸€ç­†</button>
        </div>
        
        <button class="btn-red" onclick="undo()" style="opacity:0.7;">â†©ï¸ åˆªé™¤ä¸Šä¸€ç­†</button>
    </div>

    <div id="page3_report">
        <h1>ğŸ‰ èª¿æŸ¥å®Œæˆ</h1>
        
        <div class="card" style="border: 2px dashed orange;">
            <h2>ğŸ“¸ æ­¥é©Ÿ1ï¼šæ‹ç…§å­˜è­‰</h2>
            <p>è«‹æ‹æ”ç“¶ç½åˆç…§ï¼š</p>
            <input type="file" accept="image/*" onchange="previewImg(event)">
        </div>

        <div class="card">
            <h2>ğŸ“„ æ­¥é©Ÿ2ï¼šç”¢ç”Ÿå ±å‘Š</h2>
            <div id="reportArea">
                <h3 style="background:#00695c; color:white; padding:5px;">ğŸŒŠ æµ·å»¢èª¿æŸ¥å ±å‘Š</h3>
                <div style="text-align:left; font-size:14px; line-height:1.5;">
                    æ—¥æœŸï¼š<span id="rep_date"></span><br>
                    äººå“¡ï¼š<span id="rep_name"></span> (<span id="rep_team"></span>äºº)<br>
                    åœ°é»ï¼š<span id="rep_loc"></span><br>
                    GPSï¼š<span id="rep_gps"></span>
                </div>
                <hr>
                <canvas id="myChart" style="max-height:250px;"></canvas>
                <img id="rep_img" class="evidence-photo">
            </div>
            </div>

        <button class="btn-orange" onclick="dlImg()" id="
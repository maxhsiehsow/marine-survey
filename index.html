<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V12 (å®‰å…¨ç‰ˆ)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: sans-serif; background: #e0f2f1; text-align: center; padding: 15px; margin: 0; padding-bottom: 80px; }
        .page { display: none; }
        #p1 { display: block; }

        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: left; border: 1px solid #b2dfdb; }
        h2 { margin-top: 0; color: #00796b; font-size: 18px; border-bottom: 1px solid #b2dfdb; padding-bottom: 8px; }
        
        input, select { width: 100%; padding: 12px; margin: 5px 0 15px 0; border: 2px solid #80cbc4; border-radius: 8px; font-size: 16px; background: #fff; box-sizing: border-box; }
        
        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; margin-top: 5px; }
        button:active { opacity: 0.8; }
        .btn-green { background: #00897b; }
        .btn-blue { background: #0288d1; }
        .btn-red { background: #d32f2f; }
        .btn-orange { background: #f57c00; }

        #status-bar { position: fixed; bottom: 0; left: 0; width: 100%; padding: 5px; font-size: 12px; background: #333; color: white; text-align: center; }
        
        #reader { width: 100%; background: black; display: none; margin-bottom: 10px; }
        #report-area { background: white; padding: 15px; border: 1px solid #ccc; text-align: center; }
        .evidence-img { width: 100%; margin-top: 10px; display: none; border: 1px solid #999; }
    </style>
</head>
<body>

    <div id="p1" class="page">
        <h1>ğŸ“‹ æµ·å»¢èª¿æŸ¥ V12</h1>
        
        <div class="card">
            <h2>1. åŸºæœ¬è³‡æ–™</h2>
            <label>å§“åï¼š</label>
            <input type="text" id="inp_name" placeholder="è«‹è¼¸å…¥å§“å">
            <label>äººæ•¸ï¼š</label>
            <input type="number" id="inp_team" value="1">
        </div>

        <div class="card">
            <h2>2. å®šä½</h2>
            <button class="btn-blue" onclick="doGPS()">ğŸ“ æŠ“å– GPS</button>
            <input type="text" id="inp_gps" placeholder="å°šæœªå®šä½" readonly style="background:#f1f8e9;">
            <label>åœ°é»ï¼š</label>
            <input type="text" id="inp_loc" placeholder="ä¾‹å¦‚ï¼šå¤–æ¾³æ²™ç˜">
        </div>

        <button class="btn-green" onclick="goP2()">ä¸‹ä¸€æ­¥ â¡ï¸</button>
    </div>

    <div id="p2" class="page">
        <div class="card" style="text-align:center;">
            é€²åº¦ï¼š<b id="txt_count" style="color:red; font-size:22px;">0</b> / 10
            <button class="btn-orange" id="force-btn" onclick="goP3()" style="display:none; margin-top:5px; font-size:14px;">ğŸ çµç®—æˆæœ</button>
        </div>

        <div class="card">
            <h2>ğŸ“· æƒæ (å¤–æ›åŠŸèƒ½)</h2>
            <div id="reader"></div>
            <button id="btn-cam-start" class="btn-blue" onclick="startCam()">å•Ÿå‹•ç›¸æ©Ÿ</button>
            <button id="btn-cam-stop" class="btn-red" onclick="stopCam()" style="display:none;">é—œé–‰ç›¸æ©Ÿ</button>
        </div>

        <div class="card">
            <h2>âŒ¨ï¸ æ‰‹å‹•è¨˜éŒ„ (æ ¸å¿ƒåŠŸèƒ½)</h2>
            <select id="sel_country">
                <option value="">ğŸ‘‡ è«‹é¸æ“‡åœ‹å®¶...</option>
                <option value="ğŸ‡¹ğŸ‡¼ å°ç£">ğŸ‡¹ğŸ‡¼ å°ç£</option>
                <option value="ğŸ‡¨ğŸ‡³ ä¸­åœ‹">ğŸ‡¨ğŸ‡³ ä¸­åœ‹</option>
                <option value="ğŸ‡¯ğŸ‡µ æ—¥æœ¬">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
                <option value="ğŸ‡°ğŸ‡· éŸ“åœ‹">ğŸ‡°ğŸ‡· éŸ“åœ‹</option>
                <option value="ğŸ‡»ğŸ‡³ è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå—</option>
                <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
                <option value="ğŸ‡®ğŸ‡© å°å°¼">ğŸ‡®ğŸ‡© å°å°¼</option>
                <option value="ğŸ‡µğŸ‡­ è²å¾‹è³“">ğŸ‡µğŸ‡­ è²å¾‹è³“</option>
                <option value="ğŸ‡ºğŸ‡¸ ç¾åœ‹">ğŸ‡ºğŸ‡¸ ç¾åœ‹</option>
                <option value="â“ ç„¡æ³•è¾¨è­˜">â“ ç„¡æ³•è¾¨è­˜</option>
            </select>
            <button class="btn-green" onclick="addRec()">è¨˜éŒ„é€™ä¸€ç­†</button>
        </div>
        <button class="btn-red" onclick="undo()" style="opacity:0.7;">â†©ï¸ åˆªé™¤ä¸Šä¸€ç­†</button>
    </div>

    <div id="p3" class="page">
        <h1>ğŸ‰ å®Œæˆ</h1>
        
        <div class="card">
            <h2>ğŸ“¸ æ­¥é©Ÿ 1: æ‹ç…§</h2>
            <input type="file" accept="image/*" onchange="loadImg(event)">
        </div>

        <div class="card">
            <h2>ğŸ“„ æ­¥é©Ÿ 2: å ±å‘Š</h2>
            <div id="report-area">
                <div style="background:#00796b; color:white; padding:10px;">
                    <h3>æµ·å»¢èª¿æŸ¥å ±å‘Š</h3>
                </div>
                <div style="text-align:left; font-size:14px; padding:10px;">
                    æ—¥æœŸï¼š<span id="out_date"></span><br>
                    äººå“¡ï¼š<span id="out_name"></span> (<span id="out_team"></span>äºº)<br>
                    GPSï¼š<span id="out_gps"></span>
                </div>
                <canvas id="myChart" style="max-height:250px;"></canvas>
                <div id="chart-msg" style="display:none; color:red;">(åœ–è¡¨è¼‰å…¥å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿æ•¸æ“š)</div>
                <img id="out_img" class="evidence-img">
            </div>
        </div>

        <button class="btn-orange" onclick="dlImg()">ğŸ“¥ ä¸‹è¼‰åœ–ç‰‡</button>
        <button class="btn-blue" onclick="location.reload()" style="margin-top:20px;">ğŸ”„ é‡ä¾†</button>
    </div>

    <div id="status-bar">ç³»çµ±æª¢æŸ¥ä¸­...</div>

<script>
    // === æ ¸å¿ƒè®Šæ•¸ (ä½¿ç”¨æœ€å‚³çµ±çš„ var) ===
    var count = 0;
    var target = 10;
    var stats = {};
    var historyStack = [];
    var html5QrCode = null;

    // === ç³»çµ±è‡ªæˆ‘æª¢æŸ¥ ===
    window.onload = function() {
        var status = [];
        if(typeof Html5Qrcode !== 'undefined') status.push("ç›¸æ©ŸOK"); else status.push("ç›¸æ©ŸX");
        if(typeof Chart !== 'undefined') status.push("åœ–è¡¨OK"); else status.push("åœ–è¡¨X");
        
        var msg = "ç³»çµ±å°±ç·’: " + status.join(", ");
        document

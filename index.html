<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V17</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; padding-bottom: 80px; color: #333; }
        
        /* æ¨™é¡Œ */
        h1 { text-align: center; color: #006064; margin-bottom: 10px; font-size: 22px; }
        .subtitle { text-align: center; color: #666; font-size: 13px; margin-bottom: 20px; }

        /* å¡ç‰‡å€å¡Š */
        .card {
            background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e1e4e8;
        }
        h2 { margin: 0 0 10px 0; font-size: 18px; color: #0277bd; border-bottom: 2px solid #e1f5fe; padding-bottom: 8px; }
        
        /* è¼¸å…¥å…ƒä»¶ */
        label { font-weight: bold; display: block; margin-top: 10px; font-size: 14px; }
        input, select {
            width: 100%; padding: 12px; font-size: 16px; margin: 5px 0; 
            border: 2px solid #b0bec5; border-radius: 8px; box-sizing: border-box; background: #fff;
        }
        
        /* æŒ‰éˆ•å„ªåŒ– */
        button {
            width: 100%; padding: 14px; font-size: 16px; font-weight: bold; margin-top: 10px;
            border: none; border-radius: 8px; cursor: pointer; color: white;
            transition: opacity 0.2s;
        }
        button:active { opacity: 0.7; transform: scale(0.98); }
        .btn-green { background: #2e7d32; }
        .btn-blue { background: #0288d1; }
        .btn-red { background: #c62828; }
        
        /* é€²åº¦èˆ‡çµ±è¨ˆ */
        .count-box { text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .big-num { font-size: 24px; color: #d32f2f; }
        
        /* å ±å‘Šå€ (å°ˆé–€è¨­è¨ˆçµ¦æˆªåœ–ç”¨) */
        #report-card {
            border: 4px solid #006064; padding: 0; overflow: hidden;
        }
        .report-header {
            background: #006064; color: white; padding: 15px; text-align: center;
        }
        .report-body { padding: 15px; }
        .report-info { font-size: 14px; line-height: 1.6; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px;}
        
        /* çµ±è¨ˆè¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 10px; }
        th { background: #f5f5f5; text-align: left; padding: 8px; border-bottom: 2px solid #ddd; }
        td { padding: 8px; border-bottom: 1px solid #eee; }
        
        .evidence-img { width: 100%; display: none; margin-top: 10px; border: 2px solid #333; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>ğŸ“‹ æµ·å»¢èª¿æŸ¥å“¡</h1>
    <div class="subtitle">ç©©å®šç‰ˆ V17 - è«‹ç”±ä¸Šå¾€ä¸‹æ“ä½œ</div>

    <div class="card">
        <h2>1. è¨­å®šèˆ‡å®šä½</h2>
        
        <label>èª¿æŸ¥å“¡å§“åï¼š</label>
        <input type="text" id="inp_name" placeholder="è«‹è¼¸å…¥å§“å" oninput="updateReport()">
        
        <label>GPS åº§æ¨™ï¼š</label>
        <button onclick="runGPS()" class="btn-blue">ğŸ“ é»æ­¤æŠ“å– GPS</button>
        <input type="text" id="inp_gps" readonly value="å°šæœªå®šä½" style="background:#f1f8e9; color:#2e7d32; font-weight:bold;">
        
        <label>åœ°é»åç¨±ï¼š</label>
        <input type="text" id="inp_loc" placeholder="ä¾‹å¦‚ï¼šå¤–æ¾³æ²™ç˜" oninput="updateReport()">
    </div>

    <div class="card" style="border: 2px solid #81d4fa;">
        <h2>2. æµ·å»¢è¨˜éŒ„</h2>
        <div class="count-box">
            ç›®å‰æ•¸é‡ï¼š<span id="disp_count" class="big-num">0</span> / 10
        </div>

        <label>é¸æ“‡ä¾†æºåœ‹ï¼š</label>
        <select id="sel_country">
            <option value="">ğŸ‘‡ è«‹é»é¸åœ‹å®¶...</option>
            <option value="ğŸ‡¹ğŸ‡¼ å°ç£ (Taiwan)">ğŸ‡¹ğŸ‡¼ å°ç£</option>
            <option value="ğŸ‡¨ğŸ‡³ ä¸­åœ‹ (China)">ğŸ‡¨ğŸ‡³ ä¸­åœ‹</option>
            <option value="ğŸ‡¯ğŸ‡µ æ—¥æœ¬ (Japan)">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
            <option value="ğŸ‡°ğŸ‡· éŸ“åœ‹ (Korea)">ğŸ‡°ğŸ‡· éŸ“åœ‹</option>
            <option value="ğŸ‡»ğŸ‡³ è¶Šå— (Vietnam)">ğŸ‡»ğŸ‡³ è¶Šå—</option>
            <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹ (Thailand)">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
            <option value="ğŸ‡®ğŸ‡© å°å°¼ (Indonesia)">ğŸ‡®ğŸ‡© å°å°¼</option>
            <option value="ğŸ‡µğŸ‡­ è²å¾‹è³“ (Philippines)">ğŸ‡µğŸ‡­ è²å¾‹è³“</option>
            <option value="ğŸ‡ºğŸ‡¸ ç¾åœ‹ (USA)">ğŸ‡ºğŸ‡¸ ç¾åœ‹</option>
            <option value="â“ ç„¡æ³•è¾¨è­˜">â“ ç„¡æ³•è¾¨è­˜</option>
        </select>

        <button onclick="addRecord()" class="btn-green">â• å¢åŠ ä¸€ç­†</button>
        <button onclick="undoRecord()" class="btn-red" style="opacity:0.8; margin-top:15px;">â†©ï¸ åˆªé™¤ä¸Šä¸€ç­†</button>
    </div>

    <div class="card">
        <h2>3. æ‹æ”æˆæœç…§</h2>
        <p style="font-size:13px; color:#666; margin-top:0;">è«‹å°‡æ’¿åˆ°çš„ç“¶ç½æ’å¥½ä¸¦æ‹ç…§ï¼š</p>
        <input type="file" accept="image/*" onchange="previewImage(event)">
    </div>

    <div class="card" id="report-card">
        <div class="report-header">
            <h3 style="margin:0;">ğŸŒŠ æµ·å»¢èª¿æŸ¥é›»å­å ±å‘Š</h3>
        </div>
        <div class="report-body">
            <div class="report-info">
                <strong>ğŸ“… æ—¥æœŸï¼š</strong><span id="out_date"></span><br>
                <strong>ğŸ‘¤ èª¿æŸ¥å“¡ï¼š</strong><span id="out_name"></span><br>
                <strong>ğŸ“ åœ°é»ï¼š</strong><span id="out_loc"></span><br>
                <strong>ğŸŒ GPSï¼š</strong><span id="out_gps"></span>
            </div>

            <strong>ğŸ“Š çµ±è¨ˆçµæœï¼š</strong>
            <table id="stats-table">
                <thead>
                    <tr>
                        <th>ä¾†æºåœ‹</th>
                        <th style="width:50px;">æ•¸é‡</th>
                    </tr>
                </thead>
                <tbody id="stats-body">
                    <tr><td colspan="2" style="color:#999; text-align:center;">å°šæœªè¨˜éŒ„è³‡æ–™</td></tr>
                </tbody>
            </table>

            <img id="out_img" class="evidence-img">
            
            <div style="margin-top:15px; font-size:12px; color:#999; text-align:center;">
                Powered by Marine Debris Tool V17
            </div>
        </div>
    </div>

    <div style="text-align:center; margin-top:20px; color:#666; font-size:14px;">
        âœ… èª¿æŸ¥å®Œæˆå¾Œï¼Œè«‹ç›´æ¥<b>ã€Œæ‰‹æ©Ÿæˆªåœ–ã€</b>ä¸Šæ–¹çš„å ±å‘Šå¡ç‰‡ä¿å­˜ã€‚
    </div>
    
    <button onclick="location.reload()" style="background:#546e7a; margin-top:20px;">ğŸ”„ æ¸…é™¤é‡ä¾†</button>


    <script>
        // === 1. åˆå§‹åŒ– ===
        // è¨­å®šä»Šå¤©çš„æ—¥æœŸ
        var d = new Date();
        document.getElementById('out_date').innerText = d.getFullYear() + "/" + (d.getMonth()+1) + "/" + d.getDate();

        // è®Šæ•¸
        var count = 0;
        var stats = {};
        var historyStack = [];

        // === 2. GPS åŠŸèƒ½ (ä½¿ç”¨ V16 çš„æˆåŠŸä»£ç¢¼) ===
        function runGPS() {
            var field = document.getElementById('inp_gps');
            field.value = "å®šä½ä¸­...";

            if(!navigator.geolocation) {
                alert("ç€è¦½å™¨ä¸æ”¯æ´ GPS");
                field.value = "ä¸æ”¯æ´";
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(pos) {
                    var txt = pos.coords.latitude.toFixed(5) + ", " + pos.coords.longitude.toFixed(5);
                    field.value = txt;
                    alert("å®šä½æˆåŠŸï¼");
                    updateReport(); // åŒæ­¥æ›´æ–°åˆ°å ±å‘Š
                },
                function(err) {
                    alert("å®šä½å¤±æ•—ï¼Œè«‹ç¢ºèªæ¬Šé™æˆ–æ‰‹å‹•è¼¸å…¥");
                    field.value = "";
                },
                { timeout: 10000 }
            );
        }

        // === 3. å¢åŠ è¨˜éŒ„ ===
        function addRecord() {
            var sel = document.getElementById('sel_country');
            var val = sel.value;

            if(!val) {
                alert("âŒ è«‹å…ˆé¸æ“‡ä¸€å€‹åœ‹å®¶ï¼");
                return;
            }

            // æ›´æ–°æ•¸æ“š
            if(!stats[val]) stats[val] = 0;
            stats[val]++;
            count++;
            historyStack.push(val);

            // æ›´æ–°ç•«é¢
            document.getElementById('disp_count').innerText = count;
            sel.value = ""; // é‡ç½®é¸å–®
            
            // å˜—è©¦éœ‡å‹• (æœ‰äº›æ‰‹æ©Ÿæ”¯æ´)
            try { if(navigator.vibrate) navigator.vibrate(50); } catch(e){}

            // æ›´æ–°ä¸‹æ–¹è¡¨æ ¼
            renderTable();
            
            // æç¤º
            if(count == 10) {
                alert("ğŸ‰ å·²æ”¶é›†æ»¿ 10 å€‹ï¼\nè«‹å¾€ä¸‹æ»‘å‹•ï¼Œæ‹æ”ç…§ç‰‡ä¸¦æˆªåœ–ä¿å­˜å ±å‘Šã€‚");
            }
        }

        // === 4. åˆªé™¤è¨˜éŒ„ ===
        function undoRecord() {
            if(count <= 0) return;

            var last = historyStack.pop();
            stats[last]--;
            if(stats[last] === 0) delete stats[last];
            count--;

            document.getElementById('disp_count').innerText = count;
            alert("å·²åˆªé™¤ä¸Šä¸€ç­†: " + last);
            renderTable();
        }

        // === 5. æ¸²æŸ“è¡¨æ ¼ ===
        function renderTable() {
            var tbody = document.getElementById('stats-body');
            tbody.innerHTML = ""; // æ¸…ç©º

            if(count === 0) {

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ·å»¢èª¿æŸ¥å“¡ V15</title>
    <style>
        body { font-family: sans-serif; padding: 10px; background: #f4f4f4; color: #333; max-width: 600px; margin: 0 auto; padding-bottom: 50px; }
        
        /* è¨ºæ–·æ—¥èªŒæ¡† */
        #system-log {
            background: #000; color: #0f0; font-family: monospace; font-size: 12px;
            padding: 10px; height: 100px; overflow-y: scroll; border-radius: 5px;
            margin-bottom: 15px; border: 2px solid #333;
        }

        .section { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ddd; }
        h2 { margin: 0 0 10px 0; font-size: 18px; color: #007bff; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        label { display: block; font-weight: bold; margin-top: 10px; }
        input, select { width: 100%; padding: 10px; font-size: 16px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;}
        
        button { width: 100%; padding: 12px; font-size: 16px; margin-top: 10px; cursor: pointer; color: white; border: none; border-radius: 5px; }
        .btn-blue { background: #007bff; }
        .btn-green { background: #28a745; }
        .btn-red { background: #dc3545; }
        
        /* é»æ“Šå›é¥‹ */
        button:active { opacity: 0.7; transform: translateY(2px); }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
    </style>
</head>
<body>

    <div id="system-log">ç³»çµ±åˆå§‹åŒ–...</div>

    <h1>ğŸ“‹ æµ·å»¢èª¿æŸ¥ V15</h1>

    <div class="section">
        <h2>1. è¨­å®š</h2>
        <input type="text" id="inp_name" placeholder="è¼¸å…¥å§“å (å¿…å¡«)">
        
        <label>GPS:</label>
        <button id="btn-gps" class="btn-blue">ğŸ“ æŠ“å–åº§æ¨™</button>
        <div id="gps-status" style="margin-top:5px; color:#666;">å°šæœªå®šä½</div>
        <input type="hidden" id="val_gps"> <label>åœ°é»åç¨±:</label>
        <input type="text" id="inp_loc" placeholder="è¼¸å…¥åœ°é»">
    </div>

    <div class="section">
        <h2>2. è¨˜éŒ„</h2>
        <div style="text-align:center; font-size:18px; font-weight:bold; margin-bottom:10px;">
            æ•¸é‡ï¼š<span id="disp_count" style="color:red;">0</span> / 10
        </div>

        <select id="sel_country">
            <option value="">ğŸ‘‡ é¸æ“‡åœ‹å®¶...</option>
            <option value="ğŸ‡¹ğŸ‡¼ å°ç£">ğŸ‡¹ğŸ‡¼ å°ç£</option>
            <option value="ğŸ‡¨ğŸ‡³ ä¸­åœ‹">ğŸ‡¨ğŸ‡³ ä¸­åœ‹</option>
            <option value="ğŸ‡¯ğŸ‡µ æ—¥æœ¬">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
            <option value="ğŸ‡°ğŸ‡· éŸ“åœ‹">ğŸ‡°ğŸ‡· éŸ“åœ‹</option>
            <option value="ğŸ‡»ğŸ‡³ è¶Šå—">ğŸ‡»ğŸ‡³ è¶Šå—</option>
            <option value="ğŸ‡¹ğŸ‡­ æ³°åœ‹">ğŸ‡¹ğŸ‡­ æ³°åœ‹</option>
            <option value="ğŸ‡®ğŸ‡© å°å°¼">ğŸ‡®ğŸ‡© å°å°¼</option>
            <option value="ğŸ‡µğŸ‡­ è²å¾‹è³“">ğŸ‡µğŸ‡­ è²å¾‹è³“</option>
            <option value="ğŸ‡ºğŸ‡¸ ç¾åœ‹">ğŸ‡ºğŸ‡¸ ç¾åœ‹</option>
            <option value="â“ ç„¡æ³•è¾¨è­˜">â“ ç„¡æ³•è¾¨è­˜</option>
        </select>

        <button id="btn-add" class="btn-green">â• å¢åŠ ä¸€ç­†</button>
        <button id="btn-undo" class="btn-red">â†©ï¸ åˆªé™¤ä¸Šä¸€ç­†</button>
    </div>

    <div class="section">
        <h2>3. çµæœåˆ—è¡¨</h2>
        <div id="report-text" style="font-size:13px; color:#555; margin-bottom:10px;">
            (è³‡æ–™å°‡é¡¯ç¤ºæ–¼æ­¤)
        </div>
        <table id="stats-table">
            <thead><tr><th>åœ‹å®¶</th><th>æ•¸é‡</th></tr></thead>
            <tbody id="stats-body"></tbody>
        </table>
        
        <label>ğŸ“¸ ä¸Šå‚³ç…§ç‰‡:</label>
        <input type="file" id="inp_file" accept="image/*">
        <img id="preview-img" style="width:100%; display:none; margin-top:10px; border:1px solid #333;">
    </div>

    <script>
        // === å·¥å…·ï¼šå¯«å…¥æ—¥èªŒ ===
        function log(msg) {
            var box = document.getElementById('system-log');
            var time = new Date().toLocaleTimeString();
            box.innerHTML = "<div>[" + time + "] " + msg + "</div>" + box.innerHTML;
        }

        // === 1. åˆå§‹åŒ– (ç¶å®šæŒ‰éˆ•) ===
        window.onload = function() {
            log("ç³»çµ±è¼‰å…¥å®Œæˆ");
            
            // ç¶å®š GPS æŒ‰éˆ•
            document.getElementById('btn-gps').addEventListener('click', function() {
                doGPS();
            });

            // ç¶å®š å¢åŠ  æŒ‰éˆ•
            document.getElementById('btn-add').addEventListener('click', function() {
                addRecord();
            });

            // ç¶å®š åˆªé™¤ æŒ‰éˆ•
            document.getElementById('btn-undo').addEventListener('click', function() {
                undoRecord();
            });

            // ç¶å®š ç…§ç‰‡é è¦½
            document.getElementById('inp_file').addEventListener('change', function(e) {
                previewImage(e);
            });
        };

        // === 2. GPS åŠŸèƒ½ ===
        function doGPS() {
            log("æ­£åœ¨å•Ÿå‹• GPS...");
            var statusDiv = document.getElementById('gps-status');
            statusDiv.innerText = "å®šä½ä¸­...";

            if (!navigator.geolocation) {
                log("éŒ¯èª¤: ç€è¦½å™¨ä¸æ”¯æ´ Geolocation API");
                statusDiv.innerText = "ç€è¦½å™¨ä¸æ”¯æ´";
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(pos) {
                    var lat = pos.coords.latitude.toFixed(5);
                    var lng = pos.coords.longitude.toFixed(5);
                    var txt = lat + ", " + lng;
                    
                    document.getElementById('val_gps').value = txt;
                    statusDiv.innerText = "âœ… " + txt;
                    statusDiv.style.color = "green";
                    log("GPS æˆåŠŸ: " + txt);
                    updateReport();
                },
                function(err
